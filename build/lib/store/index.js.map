{"version":3,"file":"index.js","sources":["../../../src/lib/store/src/local.js","../../../src/lib/store/src/session.js","../../../src/lib/store/index.js"],"sourcesContent":["const local = localStorage\r\nconst _set = local.setItem.bind(local)\r\nconst _get = local.getItem.bind(local)\r\nconst _remove = local.removeItem.bind(local)\r\nconst _parse = v => JSON.parse(_get(v))\r\nconst _stringify = JSON.stringify\r\nconst isString = v => typeof v === 'string'\r\nconst isObject = v => Object.prototype.toString.call(v) === '[object Object]'\r\nconst isNum = n => (typeof n == 'symbol' ? false : !isNaN(parseFloat(n)) && isFinite(n))\r\nconst hasOwn =(o,a)=> Object.prototype.hasOwnProperty.call(o,a)\r\nconst set = function (a, b) {\r\n    if (isString(a)) {\r\n        _set(a, isString(b) ? b : _stringify(b))\r\n    } else if (isObject(a)) {\r\n        for (let k in a) {\r\n            _set(k, isString(a[k]) ? a[k] : _stringify(a[k]))\r\n        }\r\n    }\r\n}\r\n\r\nconst setExpired = function (...arg) {\r\n    let [a, b, c] = arg\r\n    let d = +new Date()\r\n    let fn = function (k, v, t) {\r\n        _set(\r\n            k,\r\n            _stringify({\r\n                startTime: d, //创建并存入时间戳\r\n                expiredTime: t, //过期时间\r\n                value: v\r\n            })\r\n        )\r\n    }\r\n    if (arg.length == 1) {\r\n        //设置多个值\r\n        if (isObject(a)) {\r\n            for (let k in a) {\r\n                fn(k, a[k], 0)\r\n            }\r\n        }\r\n    } else if (arg.length == 2) {\r\n        if (isString(a)) {\r\n            fn(a, 0, b)\r\n        } else if (isObject(a) && isNum(b)) {\r\n            for (let k in a) {\r\n                fn(k, a[k], Number(b))\r\n            }\r\n        }\r\n    } else if (arg.length == 3) {\r\n        if (isString(a) && isNum(c)) {\r\n            fn(a, b, Number(c))\r\n        }\r\n    }\r\n}\r\n\r\nconst get = function (k,d) {\r\n    if (isString(k)) {\r\n        let ret = null\r\n        try {\r\n            ret =  _parse(k)\r\n            if(!isObject(ret) && !Array.isArray(ret)){\r\n                ret =  _get(k)\r\n            }\r\n            if(ret === \"false\" || ret === \"true\") {\r\n                ret =  _parse(k)\r\n            }\r\n        } catch (e) {\r\n            ret = _get(k)\r\n        }\r\n        return d!==undefined && !ret? d: ret\r\n    } else if (Array.isArray(k)) {\r\n        if(!k.length) return {}\r\n        return k.reduce((p, c) => {\r\n            let rt = null\r\n            if (isString(c) && hasOwn(local,c)) {\r\n                try {\r\n                    rt = _parse(c)\r\n                } catch (e) {\r\n                    rt = _get(c)\r\n                }\r\n                p[c] = rt\r\n            }\r\n            return p\r\n        }, {})\r\n    }\r\n}\r\n\r\n/**\r\n * @description: 获取带过期时间的缓存\r\n * @return {*}\r\n * @param {*} k\r\n */\r\nconst getExpired = function (k) {\r\n    // 如果是字符串，则获取该缓存\r\n    if(isString(k)){\r\n        let v = _parse(k)\r\n        if (v && 'startTime' in v) {\r\n            // 如果大于就是过期了，如果小于或等于就还没过期\r\n            if (new Date() - v.startTime > v.expiredTime) {\r\n                _remove(k)\r\n                return false\r\n            } else {\r\n                return v.value\r\n            }\r\n        } else {\r\n            return null\r\n        }\r\n    }else {\r\n        let ret = {}\r\n        for(let i=0;i<k.length;i++){\r\n            let key = k[i]\r\n            if(isString(key)){\r\n                let v = _parse(key)\r\n                if(v && 'startTime' in v){\r\n                    // 如果大于就是过期了，如果小于或等于就还没过期\r\n                    if (new Date() - v.startTime > v.expiredTime) {\r\n                        _remove(k)\r\n                    } else {\r\n                        ret[key]= v.value\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return ret\r\n    }\r\n}\r\n\r\nconst del = function (k) {\r\n    if (isString(k)) {\r\n        _remove(k)\r\n    } else if (Array.isArray(k)) {\r\n        for (let i = 0, len = k.length; i < len; i++) {\r\n            let j = k[i]\r\n            if (isString(j)) {\r\n                _remove(j)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst clearAll = function () {\r\n    local.clear()\r\n}\r\n\r\nconst clearAllExpired = function () {\r\n    let keys = Object.keys(local)\r\n    let len = keys.length\r\n    for (let i = 0; i < len; i++) {\r\n        let o = _parse(k)\r\n        if (o && 'expiredTime' in o) _remove(k)\r\n    }\r\n}\r\n\r\nconst each = function (cb) {\r\n    let a = Object.keys(localStorage)\r\n    for (let i = 0, len = a.length; i < len; i++) {\r\n        let k = a[i]\r\n        let v = _parse(k)\r\n        cb(k, v)\r\n    }\r\n}\r\n\r\nconst getOnce = function (k,d) {\r\n    const ret = get(k,d)\r\n    if(typeof k==='string'){\r\n        hasOwn(local,k)&& _remove(k)\r\n    }else if(Array.isArray(k)&&k.length){\r\n        for(let i=0;i<k.length;i++){\r\n            hasOwn(local,k[i])&& _remove(k[i])\r\n        }\r\n    }\r\n    return ret\r\n}\r\n\r\nexport default {\r\n    set,\r\n    get,\r\n    del,\r\n    each,\r\n    getOnce,\r\n    setExpired,\r\n    getExpired,\r\n    clearAll,\r\n    clearAllExpired\r\n}\r\n","const session = sessionStorage\r\nconst _get = session.getItem.bind(session)\r\nconst _set = session.setItem.bind(session)\r\nconst _remove = session.removeItem.bind(session)\r\nconst _clear = session.clear.bind(session)\r\nconst _stringify = JSON.stringify\r\nconst _parse = v => JSON.parse(_get(v))\r\nconst isString = v => typeof v === 'string'\r\nconst isObject = v => Object.prototype.toString.call(v) === '[object Object]'\r\nconst isArray = Array.isArray\r\nconst get = function (k,d) {\r\n    if (isString(k)) {\r\n        let ret = null\r\n        try {\r\n            ret = _parse(k)\r\n        } catch (e) {\r\n            ret = _get(k)\r\n        }\r\n        return d!==undefined && !ret? d:ret\r\n    } else if (isArray(k)) {\r\n        if(!k.length) return {}\r\n        return k.reduce((p, c) => {\r\n            let rt = null\r\n            if (isString(c)) {\r\n                try {\r\n                    rt = _parse(c)\r\n                } catch (e) {\r\n                    rt = _get(c)\r\n                }\r\n                rt&& (p[c] = rt)\r\n            }\r\n            return p\r\n        }, {})\r\n    }\r\n}\r\n\r\nconst set = function (k, v) {\r\n    if (isString(k)) {\r\n        _set(k, _stringify(v)) //set(key,val)\r\n    } else if (isArray(k)) {\r\n        //set([{key1:val1},{key2:val2}]) or set([{key1:val1,k11:val22},{key2:val2}])\r\n        for (let i = 0; i < k.length; i++) {\r\n            let j = k[i]\r\n            if (isObject(j)) {\r\n                for (let k in j) {\r\n                    _set(k, isString(j[k]) ? j[k] : _stringify(j[k]))\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst del = function (k) {\r\n    if (isString(k)) {\r\n        _remove(k)\r\n    } else if (Array.isArray(k)) {\r\n        for (let i = 0, len = k.length; i < len; i++) {\r\n            let j = k[i]\r\n            isString(j) && _remove(j)\r\n        }\r\n    }\r\n}\r\n\r\nconst clearAll = function () {\r\n    session.clear()\r\n}\r\n\r\nconst each = function (cb) {\r\n    let arr = Object.keys(sessionStorage)\r\n    for (let i = 0; i < arr.length; i++) {\r\n        cb(arr[i], get(arr[i]))\r\n    }\r\n}\r\n\r\nexport default {\r\n    get,\r\n    set,\r\n    del,\r\n    clearAll,\r\n    each\r\n}\r\n","/*\r\n * @Author: your name\r\n * @Date: 2021-06-06 15:55:08\r\n * @LastEditTime: 2021-06-08 22:09:20\r\n * @LastEditors: Please set LastEditors\r\n * @Description: In User Settings Edit\r\n * @FilePath: \\rutils\\src\\lib\\store\\index.js\r\n */\r\n\r\nimport local from './src/local'\r\nimport session from './src/session'\r\n\r\nexport default {\r\n    local,\r\n    session\r\n}\r\n"],"names":["_parse","v","JSON","parse","_get","isString","isObject","Object","prototype","toString","call","isNum","n","_typeof","isNaN","parseFloat","isFinite","hasOwn","o","a","hasOwnProperty","get","k","d","ret","Array","isArray","e","undefined","length","reduce","p","c","rt","local","localStorage","_set","setItem","bind","getItem","_remove","removeItem","_stringify","stringify","set","b","del","i","len","j","each","cb","keys","getOnce","setExpired","arg","fn","t","startTime","expiredTime","value","Date","Number","getExpired","key","clearAll","clear","clearAllExpired","session","sessionStorage","arr"],"mappings":"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"}